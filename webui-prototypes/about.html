<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About - OpenLandcoverMap</title>
    <link rel="stylesheet" href="https://api.tiles.mapbox.com/mapbox.js/v3.3.1/mapbox.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .about-image {
            float: left;
            width: 45%;
            margin-right: 20px;
            margin-bottom: 10px;
        }
            
        .about-image-2 {
            float: right;
            width: 45%;
            margin-left: 20px;
            margin-bottom: 10px;    
        }
		code {font-weight: bold;}
    </style>
</head>
<body>
    <header>
        <a href="/" class="logo">OpenLandcoverMap :)</a>
        <nav class="desktop-menu">
			<a href="about.html" class="active">About</a>
            <a href="renderedtags.html">Tag Usage</a>
            <a href="country_stats.html">Country Stats</a>
            <a href="downloads.html">Downloads</a>
            <a href="empty_hex.html">Hex Inspector</a>			
            <a href="https://github.com/Zkir/generalized_landcovers"><i class="fab fa-github"></i> GitHub</a>
        </nav>
        <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-ellipsis-v"></i>
        </button>
        <nav class="mobile-menu" id="mobileMenu">
			<a href="about.html" class="active">About</a>
            <a href="renderedtags.html">Tag Usage</a>
            <a href="country_stats.html">Country Stats</a>
            <a href="downloads.html">Downloads</a>
            <a href="empty_hex.html">Hex Inspector</a>
            <a href="https://github.com/Zkir/generalized_landcovers"><i class="fab fa-github"></i> GitHub</a>
        </nav>
    </header>

    <main class="content-page">
        <h1>About OpenLandcoverMap</h1>
        <p>The official map on <a href="https://www.openstreetmap.org/">OpenStreetMap.org</a> appears empty and devoid of character at lower zoom levels (z0-z8). This project, <strong>OpenLandcoverMap</strong>, serves as an alternative rendering to demonstrate how cartographic generalization can create a much richer and more informative map.</p>
        
        <h2>The Problem with Raw Data</h2>
        <img src="img/pic01_empty_osm.png" alt="Blank OSM map" class="about-image">
        <p><i>Other maps are such shapes, with their islands and capes! <br />
           But we've got our brave captain to thank," <br />
           (So the crew would protest) "that he's bought us the best — <br />
           A perfect and absolute blank!" </i></p>
        <p>Why does the map look so empty? OpenStreetMap contains over 10 billion objects, and it's simply impossible for any rendering engine to display all of them at once. The real challenge lies in <strong>selection and simplification</strong>, an area where the standard renderer struggles.</p>
        <p>For example, you cannot simply select cities to display based on population size. A small village in a sparsely populated region is often more locally significant than a large city in a densely populated area like Europe. Similarly, for mountains, absolute elevation is not as important as relative prominence. The most interesting peaks are those that are the tallest within a certain vicinity.</p>
        <p>Furthermore, many polygonal features like forests, fields, and swamps are mapped as countless small, fragmented pieces. Without a generalization process, they are too small to be visible on a world map.</p>
        <p>Note: what you see on z0-z4, is not even OpenStreetMap data, despite copyright notice: it's actually <a href="https://www.naturalearthdata.com/">Natural Earth</a> -- public domain <strong>generalized</strong> continents' outlines and national borders. </p>
        <h2>Generalization</h2>
        <img src="img/pic03_cities.png" alt="Hexes and Cities" class="about-image-2">
        <p>In this project we use traditional, well-known approaches to cartographic generalization: </p>
        <ol>
            <li>Inhabited Places — <strong>Constant data density</strong>;</li>
            <li>Mountain Peaks — <strong>Discrete Isolation</strong>;</li>
            <li>Landcovers — <strong>Dominant feature per hexagon</strong>;</li>
            <li>Water Bodies — <strong>Buffer & merge</strong>.</li>
        </ol>

        <p>Also, to help us out, we use Uber's <a href="https://h3geo.org">H3 hexagonal grid system</a>. </p>

        <h3>Inhabited Places (cities and towns)</h3>
        <p>For the inhabited places, the most simple generalization method — display constant number of elements per area unit —  works pretty well. 
        Instead of actual square inch, we use H3 hexagons of resolution 1.
        Then we rank each populated place by its population relative to other places within the same hexagon.
        This ensures that the most significant settlements in a large region are shown first.<p>

        <p>Benefits:</p> 
        <ul>
            <li> even small cities in a sparsely populated region are displayed; </li>
            <li> if there are several big cities nearby, they are still visible. </li>
        </ul>

        <p><i>Note: each place can still be shown with a symbol corresponding to its population and administrative status.</i></p>

        <h3>Mountain Peaks</h3>
        <img src="img/pic04_peaks.png" alt="Hexes and Cities" class="about-image">
        <p>For mountain peaks the generalization method described above does not really work. There are lots of "subsidiary" peaks nearby "main" peaks, 
        which should be  rather suppressed on a generalized map. 
        <i>For example, South Peak is located approximately 130 meters from the main Everest summit, and only 100 meters below it, 
        and is definetly not worth of showing on z0-z8</i>. </p>
 
        <p>So for mountain peaks we use another generalization method: <a href="https://link.springer.com/article/10.1007/s42489-021-00079-y">Discrete Isolation</a>. 
        Put simply, Discrete Isolation is the distance from the given point to the nearest higher point.
        This computationally intensive process is optimized using a hierarchical approach. 
        We first process peaks within each resolution 1 hexagon separately before calculating discrete isolation for the highest peaks across hexagons. </p>

        <p>This algorithm produces quite good results: not only major global peaks like Everest (8848 m) or Mont Blanc (4805 m) are highlighted, 
           but also significant local summits, such as Dzyarzhynskaya Hara (345 m), the highest point in Belarus.</p>


        <h3>Landcovers</h3>
        
        <img src="img/pic05_h3grid.png" alt="Hexes and features" class="about-image-2">
        <p>The idea for landcovers generalization is that we can find a dominant feature (or landcover type) for certain area.</p>

        <p>For each 6-km H3 hexagon (resolution 6), we identify the dominant landcover type (e.g., landuse=* or natural=*) based on the largest area covered.
        Before this, we normalize tags, for example, converting landuse=forest to natural=wood. A feature must cover at least 1% of the hexagon's area 
        (10% for built-up areas) to be considered. These hexagons are then merged to form large, cohesive landcover polygons. </p>

        <p>Note that we do not have any predefined classification of landcovers, but we find features that are actually used is OSM.  
           See the full list of supported landcover tags on the <a href="renderedtags.html">Tag Usage</a> page. </p>

        <h3> Water Bodies </h3>
        <p>For water bodies another traditional method is used. We select water bodies larger than 20 sq. km, buffer them to merge nearby water bodies,
           and then shrink them back. This process simplifies complex coastlines and merges groups of lakes/reservoirs and wide rivers, 
           taged in OSM with <code>natural=water</code>. </p>

        <h3>Rivers</h3>
		<img src="img/pic06_rivers.png" alt="Generalized rivers with calculated rank" class="about-image">
        <p>Raw river data in OpenStreetMap is far too detailed to be useful on a world map, which would otherwise be cluttered with countless tiny streams. The goal of river generalization is to create a simplified, recognizable river network showing only the most significant waterways. 
		<p>We use a modified version of the algorithm proposed by <strong>Jochen Topf</strong> in his blog post <a href="https://blog.jochentopf.com/2023-01-30-generalizing-river-networks.html">Generalizing river networks</a> and implemented in osm2pgsql-gen.</p>
        <p>Jochen Topf suggests using a "non-decreasing width" as the rank. While the idea of a non-decreasing rank seems correct, using width as the criterion is unsatisfactory. Firstly, rivers have local widenings that have no relation to their "cartographic significance." Secondly, in the proposed algorithm, when a river splits into distributaries, all of them inherit this non-decreasing width. This is undesirable because it makes all distributaries appear significant, leading to thick, messy, and ugly river lines on the map. Thirdly, width is specified (via tag or <code>natural=water</code> polygons) not for all significant rivers, especially outside Europe, which causes them to sharply lose significance, which is undesirable. </p>
        <p> Therefore, this project uses a rank based on the <strong>edge's position in the river graph</strong>, with width used only as an auxiliary parameter.
        	To achieve this, the algorithm follows a two-stage process: first, we determine the <strong>width</strong> of every river segment, and then we calculate its <strong>rank</strong> to determine its importance.</p>        
        <p><strong>Stage 1: Width Calculation</strong><br/>
        Since the <code>width</code> attribute is not usually set for waterways, we have to compute it. For wide rivers mapped as polygons (e.g., <code>natural=water</code>), the width is estimated using the PostGIS function <code>ST_MaximumInscribedCircle</code>, which finds the diameter of the largest possible circle that can fit inside the water body polygon. This calculated width is then spatially transferred to any river lines that flow through these areas. Finally, these known width values are propagated downstream along the river network to fill in any gaps.</p>
        
        <p><strong>Stage 2: Ranking and Generalization</strong><br/>
        Once widths are known, the river network is treated as a directed acyclic graph for ranking. After simplifying the graph by merging non-branching segments, the algorithm performs two critical tasks using the calculated width:
        <ol>
            <li><strong>Cycle Breaking:</strong> OSM data sometimes contains errors that create impossible loops (a river flowing in a circle). The algorithm detects these and breaks them by removing the "weakest link"—the segment with the smallest <code>width</code>.</li>
            <li><strong>Ranking:</strong> A rank is calculated to model the river's significance. Source rivers (headwaters) start with a <code>rank=1</code>. When rivers merge, their ranks are summed, thus making the downstream river more significant. Conversely, when a river splits into distributaries, the main channel inherits most of the parent's rank, while minor offshoots are assigned a rank of 1, so that the total sum of ranks is preserved. <br />
                
                Determining the "main channel" of the river is a bit tricky. The first idea is just to select the offspring with the highest width value, but surprisingly it does not always produce good results. We cannot fully rely on the <a href="https://wiki.openstreetmap.org/wiki/Relation:waterway">waterway relation</a> either, because those relations are present for major rivers only and are sometimes incomplete. 
                
                However, using both factors together gives acceptable results. The algorithm first prioritizes segments that have the <code>main_stream</code> role in a <code>waterway</code> relation. If no segments have this role, it falls back to choosing the widest channel as the main one. </li>
        </ol>
        This combined, two-tiered approach (using role data first, then width) provides a much more accurate and realistic river network than relying on width alone.</p>
		<p>The modified version of <code>osm2pgsql-gen</code> with this implemented algorithm is available in the repository at <a href="https://github.com/Zkir/osm2pgsql-patched/tree/waterway-gen-patch">https://github.com/Zkir/osm2pgsql-patched/tree/waterway-gen-patch</a>.</p>


        <h2>Technology Stack</h2>
		
        <p>This project is built on a foundation of powerful open-source tools: 
        <ul>
            <li><strong>PostgreSQL</strong> with <strong>PostGIS</strong> for spatial data storage and analysis.</li>
            <li><strong>h3-pg</strong> for H3 grid support within PostGIS.</li>
            <li><strong>osm2pgsql</strong> for importing OSM data.</li>
            <li>A series of custom <strong>SQL scripts</strong> to perform the generalization logic.</li>
            <li><strong>Mapnik</strong> and <strong>Tilemill</strong> for map rendering.</li>
            <li><strong>Python</strong> for various scripting and automation tasks.</li>
            <li><strong>Make</strong> to orchestrate the entire data processing and build pipeline.</li>
        </ul>
		</p>
        <div style="clear:both;"></div>
        <h2>License and Data Availability</h2>
        <p>The source code for the entire generalization process is available under the permissive MIT license. You can find the repository on <a href="https://github.com/Zkir/generalized_landcovers">GitHub</a>.</p>
        <p>The generalized landcover data generated by this project is also available for download. Please visit the <a href="downloads.html">Downloads</a> page to access the data.</p>

        <h2>A Final Thought</h2>
		
        <p>We hope that the awesome people responsible for the slippy map at <a href="https://www.openstreetmap.org/">openstreetmap.org</a> will look at our map, see what's possible, and think hard about the future of cartographic representation in the project.
            <img src="img/pic02_landcovers_vs_mapnik.png"  alt="Blank OSM map" width="100%"> <!-- style="float:right;"  width="100%"  class="about-image"-->
        </p>
	
		<h2>Discussion</h2>
	    <p>All questions can be asked in the <a href="https://community.openstreetmap.org/t/announcement-openlandcovermap">Openstreet Community forum</a>. Any feedback is welcome!</p>
    </main>
    <footer>
        <small>Page updated on 2025-12-05 12:38:50</small>
    </footer>

    <script>
        // Mobile menu functionality
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            document.getElementById('mobileMenu').classList.toggle('active');
        });
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            
            if (mobileMenu.classList.contains('active') && 
                !mobileMenu.contains(event.target) && 
                !mobileMenuBtn.contains(event.target)) {
                mobileMenu.classList.remove('active');
            }
        });

        // Fullscreen image functionality
        document.querySelectorAll('main img').forEach(img => {
            img.style.cursor = 'pointer';
            img.addEventListener('click', () => {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    img.requestFullscreen();
                }
            });
        });
    </script>
</body>
</html>